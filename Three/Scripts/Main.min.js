var canvas,domainInfo,fps,Animation;$().ready(function(){var n,t;canvas=$("#canvas"),domainInfo=$("#domainSize"),n=16,domainInfo.html("Domain Size: "+n+"^3"),t=new ShaderLoader,t.GetShaders(function(t){var i=new Animation(t.basic.vertex,t.basic.fragment,n);i.Animate(),i.DisplayFramerate($("span#fps"))})}),Animation=function(){function n(n,t,i){var r,u;typeof i=="undefined"&&(i=8),this.width=600,this.height=600,this.Frames=0,this.N=i,this.vertexShader=n,this.fragmentShader=t,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(this.width,this.height),canvas.append(this.renderer.domElement),this.camera=new THREE.PerspectiveCamera(70,this.width/this.height,1,1e3),this.camera.position.z=200,this.camera.position.x=10.1,this.camera.position.y=5.1,this.scene.add(this.camera),r=new THREE.DirectionalLight(16777215),r.position.set(1,0,0).normalize(),u=new THREE.CubeGeometry(101,101,101),this.mesh=new THREE.Mesh(u),this.scene.add(this.mesh),this.CreateCube(this.scene),this.controls=new THREE.TrackballControls(this.camera)}return n.prototype.Animate=function(){var n=this;requestAnimationFrame(function(){return n.Animate()}),this.renderer.render(this.scene,this.camera),this.controls.update(),this.Frames++},n.prototype.DisplayFramerate=function(n){var t=this;setInterval(function(){n.html(t.Frames.toString()),t.Frames=0},1e3)},n.prototype.CreateCube=function(n){var t=this.N,e=this.getTexture(t),f=THREE.ImageUtils.loadTexture("./Images/tiles2.jpg");f.minFilter=THREE.LinearFilter,f.magFilter=THREE.LinearFilter,f.generateMipmaps;var i=new THREE.Vector3(0,0,50),r=new THREE.Vector3(0,0,0),u=new THREE.Matrix4(t,0,0,0,0,t,0,0,0,0,-t,t,0,0,-1,1);n.add(this.GetPlane(i,r,e,f,u,t,4)),i=new THREE.Vector3(0,0,-50),r=new THREE.Vector3(Math.PI,0,0),u=new THREE.Matrix4(t,0,0,0,0,-t,0,t,0,0,t,0,0,0,1,1),n.add(this.GetPlane(i,r,e,f,u,t,4)),i=new THREE.Vector3(-50,0,0),r=new THREE.Vector3(0,-Math.PI/2,0),u=new THREE.Matrix4(0,0,t,0,0,t,0,0,t,0,0,0,1,0,0,1),n.add(this.GetPlane(i,r,e,f,u,t,4)),i=new THREE.Vector3(50,0,0),r=new THREE.Vector3(0,Math.PI/2,0),u=new THREE.Matrix4(0,0,-t,t,0,t,0,0,-t,0,0,t,-1,0,0,1),n.add(this.GetPlane(i,r,e,f,u,t,4)),i=new THREE.Vector3(0,-50,0),r=new THREE.Vector3(Math.PI/2,0,0),u=new THREE.Matrix4(t,0,0,0,0,0,t,0,0,t,0,0,0,1,0,1),n.add(this.GetPlane(i,r,e,f,u,t,4)),i=new THREE.Vector3(0,50,0),r=new THREE.Vector3(-Math.PI/2,0,0),u=new THREE.Matrix4(t,0,0,0,0,0,-t,t,0,-t,0,t,0,-1,0,1),n.add(this.GetPlane(i,r,e,f,u,t,4))},n.prototype.GetPlane=function(n,t,i,r,u,f,e){var o={volumeTexture:{type:"t",value:i},faceTexture:{type:"t",value:r},trMatrix:{type:"m4",value:u},inMatrix:{type:"m4",value:new THREE.Matrix4(1/(f+1),0,0,1/(e*(f+1)),0,1/(f*f),1/f,0,0,0,0,0,e,0,0,f)},lightDirection:{type:"v3",value:new THREE.Vector3(-1,1,1).normalize()}},s=new THREE.ShaderMaterial({vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,uniforms:o}),h=new THREE.PlaneGeometry(100,100);return this.mesh=new THREE.Mesh(h,s),this.mesh.position=n,this.mesh.rotation=t,this.mesh},n.prototype.getTexture=function(n){for(var u=new TextureHandler(n,4),e=function(n,t,i,r,f){typeof f=="undefined"&&(f=0),u.SetData.x(n,t,i,r,f),u.SetData.z(n,t,i-1,r,f),u.SetData.y(n,t-1,i,r,f),u.SetData.a(n,t-1,i-1,r,f)},t,i,s,f,o,r=0;r<=n;r++)for(t=0;t<=n;t++)for(i=0;i<=n;i++)s=r/n-.02*Math.sin(1*Math.sqrt(t*t+i*i)),e(r,t,i,Math.min(Math.max(255*s,0),255)),f=new THREE.Vector3(1/n,-.02*Math.cos(1*Math.sqrt(t*t+i*i))*1*t/Math.sqrt(t*t+i*i),-.02*Math.cos(1*Math.sqrt(t*t+i*i))*1*i/Math.sqrt(t*t+i*i)),f.normalize(),e(r,t,i,255*(-f.x+1)/2,1),e(r,t,i,255*(-f.y+1)/2,2),e(r,t,i,255*(-f.z+1)/2,3);return o=new THREE.DataTexture(u.GetTexture(),(n+1)*4,n*n,THREE.RGBAFormat,undefined,undefined,undefined,undefined,THREE.NearestFilter,THREE.NearestFilter),o.needsUpdate=!0,o},n}()